---
aliases: []
author: Yuki Wada
categories:
- 最適化
date: '2025-07-16'
description: 不等式制約付き最適化問題
draft: false
math: true
slug: inequality-constrained-optimization
title: 不等式制約付き最適化問題
weight: 999
---



<script>
function details_open(bool){
  const elems = document.getElementsByTagName('details');
  const button = document.getElementById('detail-open-button');
  const detailsOpenNext = button.innerText === "証明を開く";
  if (detailsOpenNext){
    button.innerText = "証明を閉じる";
  }
  else {
    button.innerText = "証明を開く";
  }

  for(elem of elems){
    elem.open = detailsOpenNext;
  }
}
</script>

<button type="button" id="detail-open-button" onclick="details_open(true)">証明を開く</button>



## 導入
---

最適化の枠組みでは、目的関数 \\(f(x)\\) を最小化しながら、同時に満たさなければならない条件を課すことが一般的です。とりわけ、経済学の予算制約、機械学習のノルム制限、工学の安全係数など、現実の応用で現れる制約の多くは「〜以下であること」と表現される不等式です。このため、
\\[ \\begin{gather*}  g _ {i}(x) \\le 0 \\\; (\\forall\, i)  \\end{gather*} \\]
という形の条件を伴う不等式制約付き最適化問題が理論と応用の双方で中心的な役割を果たします。

不等式制約が登場すると、以下のような新たな視点が必要になります。

* 実行可能性の判定
  不等式を満たす点がそもそも存在するかどうかは、問題の可解性を左右します。
* ラグランジュ双対性の活用
  不等式制約には非負のラグランジュ乗数が対応し、双対問題を通じて下界（あるいは上界）を提供します。
* 相補性と境界挙動の解析
  制約の境界 \\(g _ {i}(x)=0\\) が最適解でどのように「突かれる」かは、Karush–Kuhn–Tucker 条件の核心となります。


<br>


#### この記事で伝えたいこと

* 不等式制約付き最適化問題 \\(\mathcal{P}\\) の全体像を俯瞰し、理論と応用の接点を整理する
* ラグランジュ緩和関数 \\(L(x\,\lambda\,\nu)\\) と双対問題を導入し、\\(g _ {i}(x)\le0\\) の幾何学的意味を直観的に説明する
* Karush–Kuhn–Tucker 条件が「最適性のチェックリスト」として機能する理由を丁寧に導き出す
* 凸問題と非凸問題で理論がどこまで適用できるかを具体例と図解で比較する
* 数値アルゴリズム選択の観点から、実装に向けた第一歩となるヒントを提示する


<br>


#### 記事の対象者

* 最適化入門を終え、制約処理を体系的に学びたい大学生・大学院生
* 機械学習やオペレーションズリサーチで \\(g _ {i}(x)\le0\\) 型の制約に直面し、理論的裏付けを得たいエンジニア
* ポートフォリオ最適化、ロボティクス、制御工学など応用分野で不等式制約を扱う実務家
* 論文や教科書の式変形が腑に落ちず、具体的な数式展開と図解で理解を深めたい学習者


#### 参考記事
- 双対問題の定義・性質は[この記事]({{< ref "blog/双対問題" >}})も参考にしてください。



<br><br>



## 不等式制約付き最適化問題
---

実務で直面する最適化タスクの多くは、つぎの三つの側面を同時に満たす形で記述できます。

* ある性能指標を最小化（または最大化）したい
  例：コスト、エネルギー、リスクなど
* 上限型の制約を守りたい
  例：予算上限、ノルム制限、安全係数など
* 必要に応じて等式制約を併せて考慮したい
  例：物質収支、保存量、幾何学的な整合条件

このような問題では、達成したい性能指標を表す目的関数、不等式制約、等式制約という形で制約をまとめて表現できます。以下では、この一般形の問題を明示的に定義します。
定義を与えることによって、Karush–Kuhn–Tucker 条件や双対理論を正確に述べることが可能になります。

準備が整ったところで、不等式制約付き最適化問題の定義を以下に示します。

<br>


**Definition（不等式制約付き最適化問題）**
> (1) 以下の問題を不等式制約付き最適化問題 \\(\mathcal{P} \left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) と定義します。
> \\[ \\begin{align*}   \\text{infimum} \\quad & f(x) \\\\   \\text{subject to} \\quad   & g _ {i}(x) \\leq 0 \\quad (\\forall \\\, i) \\\\   & h _ {j}(x) = 0 \\quad (\\forall \\\, j)   \\end{align*} \\]
> 
> (3) 制約条件と定義域
> \\[ \\begin{gather*}  g _ {i}(x) \\leq 0 \\quad (\\forall \\\, i)\, \\quad  h _ {j}(x) = 0 \\quad (\\forall \\\, j)  \\end{gather*} \\]
> を満たす \\(x\\) を \\(\mathcal{P}\\) の実行可能解（feasible point）と定義し、\\(F(\mathcal{P})\\) と表記します。
> 
> また、最適化問題 \\(\mathcal{P}\\) の定義域を
> 
> \\[ \\begin{gather*}  \\text{dom} (\\mathcal{P}) \:= \\text{dom} (f) \\cap \\bigcap _ {i} \\text{dom} (g _ {i}) \\cap \\bigcap _ {j} \\text{dom} (h _ {j}) \\end{gather*} \\]
> 
> と定義します。\\(F (\mathcal{P})\\) と \\(\text{dom} (\mathcal{P})\\) は異なるものであることに注意してください。
> 
> (4) \\[ \\begin{gather*}  p^{\\ast} \:= \\inf _ {x \\in F} f(x) \\end{gather*} \\]
> を \\(\mathcal{P}\\) の最適値と表記し、
> \\[ \\begin{gather*} p^{\\ast} = f(x _ {0}) \\end{gather*} \\]
> を満たす \\(x _ {0}\\) を \\(\mathcal{P}\\) の最適解（optimal point）と定義します。
> 
> また、実行可能解が存在しない、つまり、\\(F(\mathcal{P}) = \empty\\) の場合を便宜的に \\( p^{\ast} = \inf _ {x \in F} f(x) = +\infty\\) とみなします。
> 


<br>


### 補足: 最適化問題の解のケース
上記の最適化問題で考えられるケースには以下の 4 通りがあります。
1. 実行可能解が存在しない（この場合を便宜的に \\( \inf _ {x \in F} f(x) = +\infty\\) とみなす）。
1. 実行可能解が存在するが、下限値が存在しない（つまり、実行可能解の集合を \\(F\\) として、\\( \inf _ {x \in F} f(x) = -\infty\\)）。
1. 実行可能解が存在し、下限値が存在するが、最適解が存在しない。
1. 実行可能解が存在し、下限値が存在し、最適解が存在する。


<br>


**Definition (不等式制約付き最適化問題の分類)**
> 不等式制約付き最適化問題 \\(\mathcal{P} \left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) を考えます。  
> 1. \\(f\, g _ {i}\, h _ {j}\\) がいずれも凸関数であるとき、\\(\mathcal{P}\\) は凸最適化問題、もしくは、凸であると定義します。  
> 1. \\(f\, g _ {i}\, h _ {j}\\) がいずれも \\(C^{1}\\) 級関数であるとき、この最適化問題は滑らかであると定義します。


<br>


不等式や等式を含む制約をそのまま扱うよりも、制約を目的関数へ組み込んで一つのスカラー量を最小化する形に置き換えると、多くの理論的・計算的利点が得られます。とくに

* 制約の満足度をペナルティとして織り込み、制約違反の大きさを連続的に評価できる
* 双対関数を通じて問題の下界（または上界）を明示的に構成できる
* 勾配情報を持つ滑らかな関数として扱えるため、数値最適化アルゴリズムを直接適用しやすい

という点が重要です。この目的で導入されるのがラグランジュ緩和関数です。以下では、主問題 \\(\mathcal{P}\\) に対して不等式制約用の乗数 \\(\lambda _ {i}\\) と等式制約用の乗数 \\(\nu _ {j}\\) を割り当て、目的関数 \\(f\\) と線形結合することで定義されるラグランジュ緩和関数を示します。


<br>


**Definition（ラグランジュ緩和関数）**
> 不等式制約付き最適化問題 \\(\left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) を考えます。
> このとき、ラグランジュ緩和関数 \\(L(x\, \lambda\, \nu)\\) を以下の式で定義します。
> \\[ \\begin{gather*}  > L(x\, \\lambda\, \\nu) \:= f(x) + \\sum _ {i=1}^{m} \\lambda _ i g _ i(x) + \\sum _ {j=1}^{p} \\nu _ j h _ j(x) >  \\end{gather*} \\]


<br>


ラグランジュ緩和関数によって目的関数と制約関数を統合しただけでは、「どの点が本当に最適なのか」の判定基準がまだ明確になりません。最適解は単にラグランジュ関数の停留点であるだけでなく、元の制約を正確に満たし、その境界での振る舞いにも整合性が求められます。
こうした要件を一括で列挙したチェックリストが Karush–Kuhn–Tucker 条件（KKT 条件）です。
KKT 条件は最適解の必要条件となるため、もし最適解が存在することがわかっているのならば、この KKT 条件を満たしている組 \\((x\,\lambda\,\nu)\\) を見つけることは最適解候補を特定する第一歩になります。

それでは、滑らかな不等式制約付き最適化問題に対する KKT 条件を正式に定義します。


<br>


**Definition（KKT 条件）**
> 滑らかな不等式制約付き最適化問題 \\(\mathcal{P} \left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) を考えます。
> \\((x^{\ast}\, \lambda^{\ast}\, \nu^{\ast})\\) が以下の条件を満たすとします。
> 1. 停留性:
>    \\[ \\begin{gather*}  \\nabla _ x L(x\, \\lambda\, \\nu) = \\nabla f(x) + \\sum _ {i=1}^{m} \\lambda _ i \\nabla g _ i(x) + \\sum _ {j=1}^{p} \\nu _ j \\nabla h _ j(x) = 0  \\end{gather*} \\]
> 1. 主問題の実行可能性:
>    \\[ \\begin{gather*}  g _ i(x) \\leq 0 \\quad (\\forall \\\, i)\, \\quad h _ j(x) = 0 \\quad (\\forall \\\, j)  \\end{gather*} \\]
> 
> 1. 双対問題の実行可能性:
>    \\[ \\begin{gather*}  \\lambda _ i \\geq 0 \\quad (\\forall \\\, i)  \\end{gather*} \\]
> 
> 1. 相補性条件:
>    \\[ \\begin{gather*}  \\lambda _ i g _ i(x) = 0 \\quad (\\forall \\\, i)  \\end{gather*} \\]
> 
> このとき、この問題は \\((x^*\, \lambda^*\, \nu^*)\\) において KKT 条件を満たすと定義します。



<br><br>


## 双対問題と KKT 条件
---

主問題と双対問題の最適解がともに存在し、かつその最適値が一致する（強双対性）とき、ラグランジュ関数の観点からは「ある一点で停留し、かつ補助変数が制約の境界を正確に突く」という幾何学的状況が必然的に生じます。これを形式化したのが Karush-Kuhn-Tucker（KKT）条件です。すなわち

* 主問題の最適解 \\(x^{\ast}\\) が実行可能集合の内部または境界上に存在し
* 双対問題の最適解 \\((\lambda^{\ast}\, \nu^{\ast})\\) が非負制約や等式制約を満たし
* ラグランジュ緩和関数 \\(L(x\, \lambda^{\ast}\, \nu^{\ast})\\) が \\(x^{\ast}\\) で最小値を取る

という三点が同時に起こることで、最適性の必要十分条件が自然に導かれます。以下の命題は、この観察を厳密に示すものです。


<br>


**Propositon (強双対性が成り立ち主・双対問題に最適解が存在するならば KKT 条件が成り立つ)**
> 滑らかな不等式制約付き最適化問題 \\(\mathcal{P} \left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) を考えます。
> このとき、強双対定理が成り立ち、かつ、主問題の最適解 \\( x^{\ast}\\)、双対問題の最適解 \\((\lambda^{\ast}\, \nu^{\ast})\\) が存在するならば、
> 、\\((x^{\ast}\, \lambda^{\ast}\, \nu^{\ast})\\) において KKT 条件が成り立ちます。
> 
> <details><summary>(Proof)</summary><div>
> 
> 「主問題の実行可能性」と「双対問題の実行可能性」は前提条件から成り立つことがわかります。
> 
> 「相補性条件」が成り立つことを示します。
> ラグランジュ緩和関数 に対して、
> 
> \\[ \\begin{align*}   & f(x^{\\ast}) \\nonumber \\\\   \\geq & f(x^{\\ast}) + \\sum _ {i=1}^{m} \\lambda _ i^{\\ast} g _ i(x^{\\ast}) + \\sum _ {j=1}^{p} \\mu _ j^{\\ast} h _ j(x^{\\ast}) \\nonumber \\\\   = & L(x^{\\ast}\, \\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\   \\geq & \\inf _ {x} L(x\, \\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\   = & g(\\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\    \\end{align*} \\]
> 
> と式変形できる。ここで、強双対定理が成り立つことから、\\(f(x^{\ast}) = g(\lambda^{\ast}\, \nu^{\ast})\\) となるため、上記の不等号は全て等号になることがわかります。
> よって、
> 
> \\[ \\begin{gather*}  \\sum _ {i=1}^{m} \\lambda _ {i}^{\\ast} g _ {i}(x^{\\ast}) + \\sum _ {j=1}^{p} \\nu _ {j}^{\\ast} h _ {j}(x^{\\ast}) = 0  \\end{gather*} \\]
> 
> となることがわかります。また、
> 
> \\[ \\begin{gather*}  L(x^{\\ast}\, \\lambda^{\\ast}. \\nu^{\\ast}) = \\inf _ {x} L(x\, \\lambda^{\\ast}\, \\nu^{\\ast})  \\end{gather*} \\]
> 
> であることから、\\(L(x\, \mu^{\ast}\, \lambda^{\ast})\\) を \\(x\\) の関数としてみたときに
> \\(x = x^{\ast}\\) で極小となることがわかるため、「停留性」が成り立つこともわかります。
> 
> </div></details>


<br>


KKT 条件は多くの場合「最適性の候補」を与えるチェックリストとして紹介されますが、その候補が真に最適解であると断言できるのは、問題が凸構造をもつときに限られます。凸性があると

* ラグランジュ緩和関数 \\(L(x\,\lambda\,\nu)\\) が \\(x\\) について凸になり、停留条件 \\(\nabla _ {x} L=0\\) はただちにグローバル最小性を保証する
* 主実行可能性・双対実行可能性・相補性の三点が合わせて強双対性 \\(f(x^{\ast}) = g(\lambda^{\ast}\,\nu^{\ast})\\) を導き、主・双対両問題で最適解が存在する

という決定的な効果が得られます。反対に、非凸問題では同じ代数的等式を満たす点があっても、それは単なる鞍点に過ぎず、主問題の値が真の最小値より大きかったり、双対ギャップが残ったりすることが珍しくありません。

以下の命題は、この「凸性の有無が sufficiency を分ける」という事実を明示するものです。すなわち、問題が凸であれば KKT 条件は主・双対問題の最適解の存在と強双対性を保証しますが、凸でなければその逆は一般には成立しない、という点に注意してください。


<br>


**Propositon (KKT 条件が成り立つならば、強双対性が成り立ちかつ主・双対問題に最適解が存在する)**
> 滑らかな不等式制約付き最適化問題 \\(\mathcal{P} \left( f\, \\{g _ {i}\\}\, \\{h _ {j}\\} \right)\\) を考えます。さらに、この問題が凸最適化問題であるとします。
> このとき、\\((x^{\ast}\, \lambda^{\ast}. \nu^{\ast})\\) において KKT 条件を満たすならば、強双対性が成り立ち、かつ、\\( x^{\ast}\\) が主問題の最適解に、\\((\lambda^{\ast}\, \nu^{\ast})\\) が双対問題の最適解になります。
> 
> <details><summary>(Proof)</summary><div>
> 
> 「相補性条件」が成り立つことから、
> 
> \\[ \\begin{gather*}  f(x^{\\ast}) = f(x^{\\ast}) + \\sum _ {i=1}^{m} \\lambda _ i^{\\ast} g _ {i}(x^{\\ast}) + \\sum _ {j=1}^{p} \\nu _ {j}^{\\ast} h _ {j}(x^{\\ast})  \\end{gather*} \\]
> 
> が成り立ちます。  
> 次に、この不等式制約付き最適化問題が凸最適化問題であることから、ラグランジュ緩和関数 \\(L(x\, \mu^{\ast}\, \lambda^{\ast})\\) は \\(x\\) の関数とみたときに凸関数であることがわかります。
> [この命題]({{< ref "blog/凸関数の性質" >}}#stationary-point-is-optimal)から、凸関数が \\(x=x^{\ast}\\) で停留条件を満たすならば \\(x=x^{\ast}\\) で最小値をとるため、
> \\[ \\begin{gather*}   >   L(x^\\ast\, \\mu^\\ast\, \\lambda^\\ast) = \\min _ {x} L(x\, \\mu^{\\ast}\, \\lambda^{\\ast}) >  \\end{gather*} \\]
> が成り立ちます。
> よって、
> \\[ \\begin{align} > & f(x^{\\ast}) \\nonumber \\\\ > = & f(x^{\\ast}) + \\sum _ {i=1}^{m} \\lambda _ i^{\\ast} g _ i(x^{\\ast}) + \\sum _ {j=1}^{p} \\mu _ j^{\\ast} h _ j(x^{\\ast}) \\nonumber \\\\ > = & L(x^{\\ast}\, \\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\ > = & \\min _ {x} L(x\, \\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\ > = & g(\\mu^{\\ast}\, \\lambda^{\\ast}) \\nonumber \\\\  > \\end{align} \\]
> 
> と式変形できます。
> このことから、強双対性が成り立ち、さらに、\\( x^{\ast}\\) が主問題の最適解に、\\((\lambda^{\ast}\, \nu^{\ast})\\) が双対問題の最適解になることが示せました。
> \\(\Box\\)
> 
> </div></details>



<br><br>



## 結論
---
## 結論

---

本記事では、不等式制約付き最適化問題 \\(\mathcal{P}\\) の理論と実装の基礎を、定義から KKT 条件まで順を追って整理しました。とくに

* ラグランジュ緩和関数 \\(L(x\,\lambda\,\nu)\\) を使うと、制約を組み込んだ一つの関数で問題を考えられること
* KKT 条件が「停留性」「主・双対の実行可能性」「相補性」の三つで最適性をチェックできること
* 問題が凸かどうかで、KKT 条件が「必要条件」から「必要十分条件」に強化されること

を確認しました。

ここでは、初学者の方が次に活かしやすいように「実務的な示唆」と「今後の学習や研究のステップ」をやさしめにまとめ直します。

### 実務的な示唆

* まずは問題が凸（くぼみがない形）かどうかを確認すると、理論も実装も一気にやりやすくなります
* 凸問題であれば、CVXOPT や SciPy の最適化関数など既存ライブラリをそのまま試すのが近道です
* 非凸でもラグランジュ緩和を使うと、「この解はどれくらい良いか」の目安（下界）がつかめます
* 制約が多いときは、紙に書き出して「本当に必要な制約はどれか」を整理するだけで、実装の見通しが良くなります

### 今後の学習や研究のステップ

* 小さな線形計画問題（LP）や二次計画問題（QP）を手計算し、Python で同じ答えが得られるか試してみてください
* 見つけた解に対して KKT 条件を手でチェックし、「理論どおりか」を確認すると理解が深まります
* ラグランジュ乗数法を使う簡単な例（例: 最小二乗法にノルム制約を付ける）を実装し、コードを動かしてみましょう
* サンプル数を増やして計算時間や収束の様子をグラフ化すると、アルゴリズムの動きを体感できます
* 余裕があれば、確率的勾配法（SGD）や内点法が制約をどう扱うのかを解説記事やオープンソース実装で読んでみるのも良い練習になります

本稿が、不等式制約付き最適化の理論と実践をつなぐ入門ガイドとして、みなさまの学習やプロジェクトの一助となれば幸いです。


<br><br>



## 参考文献
---

- <a id="kanamaori"></a>金森敬文（2015）『統計的学習理論』共立出版（機械学習プロフェッショナルシリーズ）
- <a id="boyd"></a>Boyd, S., & Vandenberghe, L. (2004). *Convex optimization*. Cambridge University Press.


